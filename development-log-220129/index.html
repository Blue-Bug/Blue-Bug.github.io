<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.10.0"/><meta data-react-helmet="true" name="description" content="N+1 문제"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="22.01.29 MyPlaylist 프로젝트 개발일지"/><meta data-react-helmet="true" property="og:description" content="N+1 문제"/><meta data-react-helmet="true" property="og:image" content="/static/b4039bee1eb2fc5567e78e176715cccd/devlog.png"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="22.01.29 MyPlaylist 프로젝트 개발일지"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="22.01.29 MyPlaylist 프로젝트 개발일지"/><meta data-react-helmet="true" name="twitter:description" content="N+1 문제"/><meta data-react-helmet="true" name="twitter:image" content="/static/b4039bee1eb2fc5567e78e176715cccd/devlog.png"/><meta data-react-helmet="true" name="twitter:site" content="@사용자이름"/><meta data-react-helmet="true" name="twitter:creator" content="@사용자이름"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><title data-react-helmet="true">22.01.29 MyPlaylist 프로젝트 개발일지</title><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="canonical" href="https://blue-bug.github.io/development-log-220129/" data-baseprotocol="https:" data-basehost="blue-bug.github.io"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 13ku56z">.css-13ku56z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}</style><main class="css-13ku56z e1strnqo0"><style data-emotion="css-global kxm5mf">@import url('https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:'Nanum Myeongjo',serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css 16cz9yp">.css-16cz9yp{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-16cz9yp{height:300px;}}</style><div class="css-16cz9yp e1opi4mu1"><style data-emotion="css 1bjn9yo">.css-1bjn9yo{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-1bjn9yo{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1bjn9yo e1opi4mu0"><div style="max-width:379px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;321&#x27;%20width=&#x27;379&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7CAAAOwgEVKEqAAAABRElEQVR42q2U38qCQBDFff836KLnCLpNMOgmykoljUrLxD+YCJbW+TgDdtFXptGBYS/W/e2cmR0VPOl+v+N2u8naFO+k4Au1AtYfnc9nzGYzrNdrWJaFxWKB5XIpsVqtJC6Xy1vwA0iblGEYcigMQ5xOJ1RVJYCiKOSb/X6P3W7XHkjYfD6HpmmYTqfI81z26v0gCNoB603XdXE4HARMm6PRCIPBQEBJksjKLDsBaZW1TNMUjuPAtm3JdrPZII7jbhmydq8O1JZ5WSdgFEWPA7T43FHP8yRaA4/Ho9SQGo/HYne73Qqc2bG2bFTnGtIim6KqKnRdR7/fR6/Xw3A4lKfU+mHTLt9iWZaPul2vV0wmE7mMzWnSP2CWZTBNU6zSHieFKy9ipr7vN45f4yzTGrNjcFK4Ns3xS+Cnv8knKfixfg78A5QxKMfK1bgqAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/b4039bee1eb2fc5567e78e176715cccd/16684/devlog.webp 95w,/static/b4039bee1eb2fc5567e78e176715cccd/d8ea5/devlog.webp 190w,/static/b4039bee1eb2fc5567e78e176715cccd/a002b/devlog.webp 379w" sizes="(min-width: 379px) 379px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 379px) 379px, 100vw" decoding="async" loading="lazy" data-src="/static/b4039bee1eb2fc5567e78e176715cccd/6458d/devlog.png" data-srcset="/static/b4039bee1eb2fc5567e78e176715cccd/28f38/devlog.png 95w,/static/b4039bee1eb2fc5567e78e176715cccd/a9ddf/devlog.png 190w,/static/b4039bee1eb2fc5567e78e176715cccd/6458d/devlog.png 379w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/b4039bee1eb2fc5567e78e176715cccd/16684/devlog.webp 95w,/static/b4039bee1eb2fc5567e78e176715cccd/d8ea5/devlog.webp 190w,/static/b4039bee1eb2fc5567e78e176715cccd/a002b/devlog.webp 379w" sizes="(min-width: 379px) 379px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 379px) 379px, 100vw" decoding="async" loading="lazy" src="/static/b4039bee1eb2fc5567e78e176715cccd/6458d/devlog.png" srcSet="/static/b4039bee1eb2fc5567e78e176715cccd/28f38/devlog.png 95w,/static/b4039bee1eb2fc5567e78e176715cccd/a9ddf/devlog.png 190w,/static/b4039bee1eb2fc5567e78e176715cccd/6458d/devlog.png 379w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css m1156n">.css-m1156n{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:100%;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-m1156n{width:100%;padding:40px 20px;}}</style><div class="css-m1156n e1st1jau3"><style data-emotion="css gywgo7">.css-gywgo7{display:grid;place-items:center;width:40px;height:40px;border-radius:50%;background:#ffffff;color:#000000;font-size:22px;cursor:pointer;box-shadow:0 0 10px rgba(0, 0, 0, 0.3);}@media (max-width: 768px){.css-gywgo7{width:30px;height:30px;font-size:18px;}}</style><div class="css-gywgo7 e1st1jau2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg></div><style data-emotion="css gn4qtp">.css-gn4qtp{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin-top:auto;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-gn4qtp{font-size:30px;}}</style><div class="css-gn4qtp e1st1jau1">22.01.29 MyPlaylist 프로젝트 개발일지</div><style data-emotion="css 3gcnt2">.css-3gcnt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-3gcnt2{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-3gcnt2 e1st1jau0"><div>Devlog</div><div>2022.01.29.</div></div></div></div><style data-emotion="css uo146q">.css-uo146q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0;word-break:break-all;line-height:1.8;font-size:16px;font-weight:400;}.css-uo146q p{padding:3px 0;}.css-uo146q h1,.css-uo146q h2,.css-uo146q h3{font-weight:800;margin-bottom:30px;}.css-uo146q *+h1,.css-uo146q *+h2,.css-uo146q *+h3{margin-top:80px;}.css-uo146q hr+h1,.css-uo146q hr+h2,.css-uo146q hr+h3{margin-top:0;}.css-uo146q h1{font-size:30px;}.css-uo146q h2{font-size:25px;}.css-uo146q h3{font-size:20px;}.css-uo146q blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}.css-uo146q ol,.css-uo146q ul{margin-left:20px;padding:30px 0;}.css-uo146q hr{border:1px solid #000000;margin:100px 0;}.css-uo146q a{color:#4263eb;-webkit-text-decoration:underline;text-decoration:underline;}.css-uo146q pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}.css-uo146q pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);border-radius:3px;}.css-uo146q code[class*='language-'],.css-uo146q pre[class*='language-']{tab-size:2;}@media (max-width: 768px){.css-uo146q{width:100%;padding:80px 20px;line-height:1.6;font-size:14px;}.css-uo146q h1{font-size:23px;}.css-uo146q h2{font-size:20px;}.css-uo146q h3{font-size:17px;}.css-uo146q img{width:100%;}.css-uo146q hr{margin:50px 0;}}</style><div class="css-uo146q e1ijh0y10"><h3>1. 검색 쿼리의 N+1 문제를 해결하기 위한 방법</h3>
<p>Posts에서 fetch join을 하는 것이 아니라, Link에서부터 ManyToOne 관계로 변경하면<br>
Row수가 Link의 수로 결정됨 그래서 연관관계 변경이 아닌 BatchSize 설정을 사용하기로 함</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">기존에 OneToMany를 전부 FetchMode.SUBSELECT로 IN 절 안에 서브쿼리를 통하여
가져왔었는데 이 방법 대신에 BatchFetchSize를 설정하면 그 수만큼
Hibernate가 PreparedStatement로 최적화하여 IN 절에
ID 값을 넣어 보내는 것으로 바꾼다.

이 방법을 사용하면 전부 Join해서 가져올 때보다 쿼리는 많이 나가지만
거의 테이블 당 하나씩만 나가게 되며 데이터의 Row가 필요한만큼만 최적화 된다.

사용 방법은 ToMany에 해당하는 엔티티 속성 위에 @BatchSize를 사용하거나
전역 설정으로
spring.jpa.properties.hibernate.default_batch_fetch_size=1000
spring.jpa.properties.hibernate.batch_fetch_style: PADDED 을 주면 된다.

fetch_style을 PADDED로 주게 되면 내가 설정한 최대 크기 만큼 나가게 된다.
DYNAMIC을 주면 무조건 내가 원하는 크기만큼 나가긴 하지만 이것은 DB에서
미리 캐싱해야하는 PreparedStatement가 많아지므로 PADDED를 사용하는 것이
내 생각엔 가장 좋을 것 같다.(링크 참조 : https://www.inflearn.com/questions/34469)
만약 25가 최대 크기인데 24개를 조회한다면 나머지 1개는 식별자 하나가 반복되어
쿼리가 나가게 된다.(사진을 참고하면 쉽다.)</code></pre></div>
<center>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; ">
      <a class="gatsby-resp-image-link" href="/static/af65fa84a3d9852fb00c431648f3d625/1c9e3/220129devlog1.jpg" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75.52083333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAByyAH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABPyFf/9oADAMBAAIAAwAAABCwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABcQAQEBAQAAAAAAAAAAAAAAAAABESH/2gAIAQEAAT8QWReMq66//9k='); background-size: cover; display: block;"></span>
  <picture>
          <source srcset="/static/af65fa84a3d9852fb00c431648f3d625/a59e9/220129devlog1.webp 192w,
/static/af65fa84a3d9852fb00c431648f3d625/0ca9f/220129devlog1.webp 384w,
/static/af65fa84a3d9852fb00c431648f3d625/98f86/220129devlog1.webp 547w" sizes="(max-width: 547px) 100vw, 547px" type="image/webp">
          <source srcset="/static/af65fa84a3d9852fb00c431648f3d625/150b2/220129devlog1.jpg 192w,
/static/af65fa84a3d9852fb00c431648f3d625/6985d/220129devlog1.jpg 384w,
/static/af65fa84a3d9852fb00c431648f3d625/1c9e3/220129devlog1.jpg 547w" sizes="(max-width: 547px) 100vw, 547px" type="image/jpeg">
          <img class="gatsby-resp-image-image" src="/static/af65fa84a3d9852fb00c431648f3d625/1c9e3/220129devlog1.jpg" alt="220129devlog1" title="" loading="lazy" decoding="async" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;">
        </picture>
  </a>
    </span>
<b>[BatchSize 설정 사진]
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 495px; ">
      <a class="gatsby-resp-image-link" href="/static/0018bdca9b3d870253ab8ae59c0e9116/8b9a3/220129devlog2.jpg" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 32.29166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAd2kgP/EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABgRAAIDAAAAAAAAAAAAAAAAAAABAiEx/9oACAECAQE/AZYJ0f/EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABYQAQEBAAAAAAAAAAAAAAAAAAEAEP/aAAgBAQABPyEwv//aAAwDAQACAAMAAAAQh9//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxAn/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EEmiZC3/xAAaEAEAAwADAAAAAAAAAAAAAAABABEhMYHw/9oACAEBAAE/ELO5Eb4PdQNaE//Z'); background-size: cover; display: block;"></span>
  <picture>
          <source srcset="/static/0018bdca9b3d870253ab8ae59c0e9116/a59e9/220129devlog2.webp 192w,
/static/0018bdca9b3d870253ab8ae59c0e9116/0ca9f/220129devlog2.webp 384w,
/static/0018bdca9b3d870253ab8ae59c0e9116/49d8f/220129devlog2.webp 495w" sizes="(max-width: 495px) 100vw, 495px" type="image/webp">
          <source srcset="/static/0018bdca9b3d870253ab8ae59c0e9116/150b2/220129devlog2.jpg 192w,
/static/0018bdca9b3d870253ab8ae59c0e9116/6985d/220129devlog2.jpg 384w,
/static/0018bdca9b3d870253ab8ae59c0e9116/8b9a3/220129devlog2.jpg 495w" sizes="(max-width: 495px) 100vw, 495px" type="image/jpeg">
          <img class="gatsby-resp-image-image" src="/static/0018bdca9b3d870253ab8ae59c0e9116/8b9a3/220129devlog2.jpg" alt="220129devlog2" title="" loading="lazy" decoding="async" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;">
        </picture>
  </a>
    </span>
[PADDED 옵션이 적용된 모습]</b>
</center>
<h3>2. 방법은 알았는데 이상하게 적용이 안됐다. 전체 조회 쿼리는 Batch fetch가 잘 작동하는데 이상하게 검색 쿼리만 날리면 N+1 문제가 그대로 발생하였다.</h3>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  알고보니 PostsService에서 searchPosts 메소드에 @Transactional(readOnly=true)가 붙어있지가 않아 발생한 문제였다.</code></pre></div>
<h3>3. 왜 countQuery가 없으면 오류가 뜨나?</h3>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  페이징을 하기 위해서는 전체 카운트가 꼭 있어야한다.
  그래야 몇 page까지 있는지 알 수 있다.

  그래서 countQuery가 없으면 Spring Data JPA가 임의로 원본 쿼리를 보고 countQuery를 작성하는데,
  이때 쿼리에 페치 조인이 들어가게 된다.

  페치 조인은 객체 그래프를 조회하는 기능이기 때문에 연관된 부모가 반드시 있어야하나,
  countQuery의 경우 count(u)로 조회 결과가 변경되었기 때문에 오류가 발생한 것이다.

  따라서 fetch join이나 복잡한 쿼리의 경우 반드시 countQuery를 분리해서 사용하자.</code></pre></div>
<h3>Source</h3>
<ul>
<li><a href="https://dev-gorany.tistory.com/348" target="_blank" rel="nofollow">https://dev-gorany.tistory.com/348</a></li>
</ul></div><style data-emotion="css hx9xpc">@media (max-width: 768px){.css-hx9xpc{padding:0 20px;}}</style><div class="css-hx9xpc e1gqsjds0"></div><style data-emotion="css 9w9jmx">.css-9w9jmx{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-9w9jmx{font-size:13px;}}</style><footer class="css-9w9jmx e1oae0v80">볼 건 없지만 많이 보고 가세요<br/>© 2023 Developer BlueBug, Powered By Gatsby.</footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/development-log-220129/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-128d32aff60fcd41dc5f.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-75ce00657666ba008169.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-d59a572586ef493c7a0c.js\"],\"component---src-pages-info-tsx\":[\"/component---src-pages-info-tsx-9a6008cc21e669a666bf.js\"],\"component---src-templates-post-template-tsx\":[\"/component---src-templates-post-template-tsx-3db2c1d3199b843e8452.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="5b5e56e769b1432260ad";</script><script src="/webpack-runtime-eb8c55fbaf95e12831e7.js" async></script><script src="/framework-6a525285796fb83f2864.js" async></script><script src="/app-128d32aff60fcd41dc5f.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>