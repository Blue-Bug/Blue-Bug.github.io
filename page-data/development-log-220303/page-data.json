{"componentChunkName":"component---src-templates-post-template-tsx","path":"/development-log-220303/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>1. hibernate 배치에 관한 글</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-> Source 1번 확인</code></pre></div>\n<h3>2. insert나 update는 제대로 배치설정대로 쿼리가 나가는데 delete는 안되는 이유</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">hibernate의 ActionQueue에서 delete문은 정렬되지 않는다\r\n-> JDBC 배치 는 모든 문이 동일한 데이터베이스 테이블에 속하는 경우에만 재사용할 수 있다.\r\n-> 즉 delete는 정렬되지 않기 때문에 테이블 순서가 섞여서 들어오게 되므로 배치불가\r\n-> 연관 객체들을 수동으로 지우고 플러쉬를 먼저 날리거나\r\n-> Cascade Delete 옵션을 줘서 배치로 만들 수 있다.</code></pre></div>\n<h3>3. 배치(벌크)는 한번에 여러개의 쿼리를 모아서 보낸다(마치 preparedStatment처럼 동작하게 해줌)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rewriteBatchedStatements 옵션을 db에 연결할때 url 파라미터로 넣어주면\r\ninsert 쿼리도 멀티라인 insert로 재구성된다.</code></pre></div>\n<h3>4. @OnDelete(action = OnDeleteAction.CASCADE) 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DB 제약조건도 수정완료</code></pre></div>\n<h3>5. logging.level.org.hibernate.engine.jdbc.batch.internal.BatchingBatch=DEBUG</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">설정으로 넣어주면 배치사이즈를 볼 수 있다.</code></pre></div>\n<h3>6. 배치로 나가는것도 좋지만 여기서 deleteAllInBatch를 쓰면 jpa가 1차캐시에서 db로 쿼리가 나가기 전에 컬렉션안에 있는 모든 엔티티를 지우는 한줄의 쿼리로 만들어 준다.</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-> 대신 컬렉션을 만들고 그 안에 모든 엔티티를 넣어야 하니 지워야할 엔티티숫자가 크다면 메모리를 생각해서 쓰지 않는것이 좋을 것 같다.</code></pre></div>\n<h3>7. addPosts 와 deletePosts할때 6번의 메소드를 썼는데 제거함</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">엔티티에 Cascade 옵션과 orphanRemoval 옵션을 줬음\r\n-> 대신 싱글 라인 쿼리로 나가던 이점이 사라짐</code></pre></div>\n<h3>Source</h3>\n<ul>\n<li><a href=\"https://techblog.woowahan.com/2695/\" target=\"_blank\" rel=\"nofollow\">https://techblog.woowahan.com/2695/</a></li>\n<li><a href=\"https://vladmihalcea.com/how-to-batch-delete-statements-with-hibernate/\" target=\"_blank\" rel=\"nofollow\">https://vladmihalcea.com/how-to-batch-delete-statements-with-hibernate/</a></li>\n<li><a href=\"https://velog.io/@rainmaker007/spring-data-jpa-batch-insert-%EC%A0%95%EB%A6%AC\" target=\"_blank\" rel=\"nofollow\">https://velog.io/@rainmaker007/spring-data-jpa-batch-insert-%EC%A0%95%EB%A6%AC</a></li>\n</ul>","frontmatter":{"title":"22.03.03 MyPlaylist 프로젝트 개발일지","summary":"쿼리 유지 보수","date":"2022.03.03.","categories":["Devlog"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7CAAAOwgEVKEqAAAABRElEQVR42q2U38qCQBDFff836KLnCLpNMOgmykoljUrLxD+YCJbW+TgDdtFXptGBYS/W/e2cmR0VPOl+v+N2u8naFO+k4Au1AtYfnc9nzGYzrNdrWJaFxWKB5XIpsVqtJC6Xy1vwA0iblGEYcigMQ5xOJ1RVJYCiKOSb/X6P3W7XHkjYfD6HpmmYTqfI81z26v0gCNoB603XdXE4HARMm6PRCIPBQEBJksjKLDsBaZW1TNMUjuPAtm3JdrPZII7jbhmydq8O1JZ5WSdgFEWPA7T43FHP8yRaA4/Ho9SQGo/HYne73Qqc2bG2bFTnGtIim6KqKnRdR7/fR6/Xw3A4lKfU+mHTLt9iWZaPul2vV0wmE7mMzWnSP2CWZTBNU6zSHieFKy9ipr7vN45f4yzTGrNjcFK4Ns3xS+Cnv8knKfixfg78A5QxKMfK1bgqAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/b4039bee1eb2fc5567e78e176715cccd/6458d/devlog.png","srcSet":"/static/b4039bee1eb2fc5567e78e176715cccd/28f38/devlog.png 95w,\n/static/b4039bee1eb2fc5567e78e176715cccd/a9ddf/devlog.png 190w,\n/static/b4039bee1eb2fc5567e78e176715cccd/6458d/devlog.png 379w","sizes":"(min-width: 379px) 379px, 100vw"},"sources":[{"srcSet":"/static/b4039bee1eb2fc5567e78e176715cccd/16684/devlog.webp 95w,\n/static/b4039bee1eb2fc5567e78e176715cccd/d8ea5/devlog.webp 190w,\n/static/b4039bee1eb2fc5567e78e176715cccd/a002b/devlog.webp 379w","type":"image/webp","sizes":"(min-width: 379px) 379px, 100vw"}]},"width":379,"height":321}},"publicURL":"/static/b4039bee1eb2fc5567e78e176715cccd/devlog.png"}}}}]}},"pageContext":{"slug":"/development-log-220303/"}},"staticQueryHashes":[],"slicesMap":{}}